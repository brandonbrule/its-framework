/*! its-framework 2017-05-05 */
document.addEventListener("keydown",function(a){9!==a.keyCode&&16!==a.keyCode&&32!==a.keyCode&&Dispatch.init(a)}),document.addEventListener("keyup",function(a){9!==a.keyCode&&16!==a.keyCode&&32!==a.keyCode&&Dispatch.init(a)}),document.addEventListener("change",function(a){Dispatch.init(a)}),document.addEventListener("click",function(a){Dispatch.init(a)}),window.addEventListener("load",function(a){Dispatch.init(a)});var Dispatch=function(){var a={changed:null,event_type:null,element:null,type:null,value:null,control:null},b={},c=function(){a.element.hasAttribute("its-control")?a.control=a.element.getAttribute("its-control"):a.control=null},d=function(){a.element.value?"checkbox"===a.type?a.element.checked?a.value=a.element.value:a.value="":a.value=a.element.value:a.value=null},e=function(){a.element.value?a.innerHTML=null:"SELECT"!==a.element.nodeName&&(a.innerHTML=a.element.innerHTML)},f=function(){if(!b[a.control])return b[a.control]=[{value:a.value,innerHTML:a.innerHTML}],void(a.changed=!0);1===b[a.control].length&&(b[a.control][0].value===a.value?(a.changed=!1,"BUTTON"===a.nodeName&&(a.changed=!1),"checkbox"===a.type&&(a.element.checked?a.changed=!0:a.changed=!1),"submit"===a.type&&(a.changed=!0)):(a.changed=!0,b[a.control][0].value=a.value,b[a.control][0].innerHTML=a.innerHTML))},g=function(b){b.keyCode?a.key=b.keyCode:a.key&&delete a.key},h=function(b){return a.event_type=b.type,b.currentTarget===window?(a.type=null,a.changed=!0,a.control=null,a.element="window",a.nodeName=null,a):(a.element=b.target,a.nodeName=b.target.nodeName,a.value=null,a.innerHTML=null,b.target.getAttribute("type")?a.type=b.target.getAttribute("type"):a.type=null,g(b),c(b),a.control?(d(),e(),f()):(a.changed=null,d()),a)};return{init:function(a){var b=h(a),c=State.init(b),d={ev:b,state:c};Views.init(d),void 0!==Store&&Store.init(d)}}}(),State=function(){var a={},b=function(){return a},c=function(a,b){function c(b){for(var f in b)d+=f,"object"==typeof b[f]&&null!==b[f]?(d+=".",c(b[f])):(e.push(d),d=a);return e}var a=a+".",d=a,e=[];return c(b)},d=function(a,b,c){lastKeyIndex=b.length-1;for(var d=0;d<lastKeyIndex;++d)key=b[d],key in a||(a[key]={}),a=a[key];c?a[b[lastKeyIndex]]=c:delete a[b[lastKeyIndex]]},e=function(){var b=document.querySelectorAll("[its-control]");[].forEach.call(b,function(b){var c=b.getAttribute("its-control"),e=b.value;if(-1!==c.indexOf(".")){if(e){var f=c.split(".");d(a,f,e)}}else if("BUTTON"===b.nodeName)"true"===b.getAttribute("its-active")&&(a[c]=e);else switch(b.getAttribute("type")){case"checkbox":case"radio":b.checked&&(a[c]=e);break;default:"submit"!==b.getAttribute("type")&&(e.length>0&&(a[c]=e),a[c]&&(e=a[c]))}})},f=function(a,b){var d=State.Obj();if(d[a]=b,data={control:a,value:b},null!==d[a]&&"object"==typeof d[a]){var e=c(a,d[a]);[].forEach.call(e,function(a){data.action="state.set",data.value=a,data.type="views",Views.update(data),data.type="controls",Views.update(data)})}else data.type="views",Views.update(data),data.type="controls",Views.update(data)};return{init:function(b){if(b.control)if(-1!==b.control.indexOf(".")){var c=b.control.split(".");d(a,c,b.value)}else"submit"!==b.type&&(a[b.control]=b.element.value),"BUTTON"===b.nodeName&&(b.element.value||delete a[b.control]),"checkbox"===b.type&&(b.element.checked||delete a[b.control]),a.null&&delete a.null,a[""]&&delete a[""];return"load"===b.event_type&&e(),a},Set:f,Obj:b,updateAll:e}}(),Store=function(){return{init:function(a){Help.state(a.state,document.querySelector('[its-view="state"]')),Help.view(a.ev,document.querySelector('[its-view="event"]'))}}}(),Views=function(){var a={views:{type:[],element:[]},controls:{type:[],element:[]}},b=function(a,b){for(var c=-1,d=[];-1!==(c=a.indexOf(b,c+1));)d.push(c);return d},c=function(){var b=document.querySelectorAll("[its-view]"),c=document.querySelectorAll("[its-control]");a.views.type=[],a.views.element=[],[].forEach.call(b,function(b){a.views.type.push(b.getAttribute("its-view")),a.views.element.push(b)}),a.controls.type=[],a.controls.element=[],[].forEach.call(c,function(b){a.controls.type.push(b.getAttribute("its-control")),a.controls.element.push(b)})},d=function(a,b){for(var c=a.split("."),d=null,e=0;e<c.length;e++){var f=c[e];d=d?d[f]:b[f]}return d},e=function(c){var e,g=c.control,h=c.value,i=c.type;null!==h&&-1!==h.indexOf(".")?(e="state.set"===c.action?b(a[i].type,h):b(a[i].type,g),d(h,State.Obj())&&(h=d(h,State.Obj()))):e=b(a[i].type,g),[].forEach.call(e,function(b){var c=a[i].element[b];"controls"===i?"BUTTON"!==c.nodeName?("number"===c.getAttribute("type")&&"range"===c.getAttribute("type")&&c.max<h&&!c.max&&(c.max=h),"radio"!==c.getAttribute("type")&&"checkbox"!==c.getAttribute("type")&&"submit"!==c.getAttribute("type")&&(c.value=h),"radio"!==c.getAttribute("type")&&"checkbox"!==c.getAttribute("type")||f(c,g,h)):f(c,g,h):c.innerHTML=h})},f=function(c,d,e){var f=b(a.controls.type,d);c.value,c.getAttribute("its-control");[].forEach.call(f,function(b){var c=a.controls.element[b];c.getAttribute("its-control")===d&&(c.removeAttribute("its-active"),c.checked=!1),c.value===e&&("BUTTON"===c.nodeName&&c.setAttribute("its-active",!0),"radio"!==c.getAttribute("type")&&"checkbox"!==c.getAttribute("type")||(c.checked=!0))})},g=function(c){state=c.state,[].forEach.call(a.controls.element,function(c){var e=c.getAttribute("its-control"),f=state[e];if(null!==e&&-1!==e.indexOf(".")&&(f=d(e,state)),f)if("BUTTON"!==c.nodeName)"number"===c.getAttribute("type")&&"range"===c.getAttribute("type")&&c.max<f&&!c.max&&(c.max=f),"radio"!==c.getAttribute("type")&&"checkbox"!==c.getAttribute("type")&&"submit"!==c.getAttribute("type")&&(c.value=f);else if(c.hasAttribute("its-control")&&"true"===c.getAttribute("its-active")){var g=b(a.controls.type,c.getAttribute("its-control")),h=c.value,i=c.getAttribute("its-control");[].forEach.call(g,function(b){var c=a.controls.element[b];c.getAttribute===i&&c.removeAttribute("its-active"),c.value===h&&"BUTTON"===c.nodeName&&c.setAttribute("its-active",!0)})}}),[].forEach.call(a.views.element,function(a){var b=a.getAttribute("its-view"),c=state[b];null!==b&&-1!==b.indexOf(".")&&(c=d(b,state)),c&&("TEXTAREA"===a.nodeName||"INPUT"===a.nodeName?a.value=c:a.innerHTML=c)})};return{init:function(a){var b={control:a.ev.control,value:a.ev.value};a.ev.changed&&a.ev.control&&(b.type="views",e(b),b.type="controls",e(b)),"BUTTON"===a.ev.nodeName&&(b.type="views",e(b)),"load"===a.ev.event_type&&(c(),g(a))},cacheViews:c,update:e,updateAll:g}}(),Dynamic=function(){return{element:function(a){if("new"===a.control){var b=a.element.parentNode,c=document.createElement("textarea");c.setAttribute("class","dynamic-row"),c.setAttribute("its-control","dynamic"),document.querySelector('[its-control="dynamic"]')&&(c.value=document.querySelector('[its-control="dynamic"]').value),b.appendChild(c),Views.cacheViews()}}}}(),Help=function(){var a=[{control:null,event_type:null,value:null}],b=function(a,b){if(b&&"state"===b.getAttribute("its-view")){var c=JSON.stringify(a,null,4);b.innerHTML=c}};return{view:function(b,c){if(c&&"event"===c.getAttribute("its-view")){var d,e,f=document.createElement("pre");b.element&&"window"!==b.element&&(b.element="e.target"),d=b.event_type?b.event_type:null,e=b.control?b.control:null,a.unshift({control:e,event_type:d,value:b.value}),3===a.length&&a.pop(),c.children.length>1&&c.removeChild(c.childNodes[0]),b.control===a[1].control?(b.event_type===a[1].event_type&&(c.innerHTML=""),b.value!==a[1].value&&(c.innerHTML=""),f.innerHTML=JSON.stringify(b,null,4),c.appendChild(f)):(f.innerHTML=JSON.stringify(b,null,4),c.innerHTML="",c.insertBefore(f,c.firstChild))}},state:b}}();